#cloud-config
autoinstall:
  version: 1
  locale: en_US.UTF-8
  keyboard:
    layout: us
  identity:
    hostname: ubuntu-server
    username: packer
    # This is "packer" hashed
    password: "$6$rounds=4096$2RjBJvyXEY$QgvXyAO6MJoMEPVJrS8KzJlSuGPXdAAzLYjS0J3A1Iw7kIqjWRfOVTPU2v.ePIjbRvHNzSYTP0rxETJKm0/7k1"
  ssh:
    install-server: true
    allow-pw: true
  storage:
    layout:
      name: direct
  network:
    network:
      version: 2
      ethernets:
        ens192:
          dhcp4: false
          addresses: [192.168.0.100/24]
          gateway4: 192.168.0.1
          nameservers:
            addresses: [8.8.8.8, 8.8.4.4]
  late-commands:
    - echo 'packer ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/packer
    - chmod 440 /target/etc/sudoers.d/packer
    - echo 'PasswordAuthentication yes' > /target/etc/ssh/sshd_config.d/allow_passwd.conf
    - echo 'PermitRootLogin yes' >> /target/etc/ssh/sshd_config.d/allow_passwd.conf
